<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PVZ Widget Harness</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 0; }
      .toolbar { padding: 12px; border-bottom: 1px solid #ddd; display: flex; gap: 8px; align-items: center; }
      #widget { width: 1200px; max-width: 100%; height: 780px; margin: 12px auto; border: 1px solid #ddd; }
      #log { margin: 12px; padding: 8px; background: #f6f7fb; min-height: 48px; white-space: pre-wrap; }
    </style>
    <script src="https://ndd-widget.landpro.site/widget.js" async></script>
  </head>
  <body>
    <div class="toolbar">
      <button id="create">Create widget</button>
      <button id="update">Update params</button>
    </div>
    <div id="widget"></div>
    <pre id="log"></pre>
    <script>
      const log = document.getElementById('log');
      const write = (v) => (log.textContent = `${new Date().toISOString()}\n${v}`);

      const params = {
        city: 'Москва',
        size: { width: '1200px', height: '780px' },
        show_select_button: true,
        filter: { type: ['pickup_point', 'terminal'] }
      };

      document.getElementById('create').addEventListener('click', () => {
        if (!window.YaDelivery?.createWidget) {
          write('YaDelivery is not loaded');
          console.error('YaDelivery is not loaded');
          return;
        }

        window.YaDelivery.createWidget({ containerId: 'widget', params });
        write('Widget created');
      });

      document.getElementById('update').addEventListener('click', () => {
        window.YaDelivery?.setParams?.(params);
        window.dispatchEvent(new Event('resize'));
        write('Widget params updated');
      });

      document.addEventListener('YaNddWidgetPointSelected', (event) => {
        write(`Selected:\n${JSON.stringify(event.detail, null, 2)}`);
      });
    </script>
  </body>
</html>
